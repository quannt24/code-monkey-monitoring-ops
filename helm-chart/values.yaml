global:
  # Internal cluster domain
  clusterDomain: cluster.local
  tenantId: code-monkey
  # loki:
  #   basicAuthUsername: sops_secret
  #   basicAuthPassword: sops_secret

loki:
  loki:
    revisionHistoryLimit: 2
    # When auth_enabled is true, Loki will require authentication for all requests,
    # and the header "X-Scope-OrgID" must be set in requests.
    auth_enabled: true
    storage:
      type: filesystem
  gateway:
    revisionHistoryLimit: 2
    deploymentStrategy:
      type: Recreate
    basicAuth:
      enabled: true
      # htpasswd: sops_secret
  test:
    enabled: false
  lokiCanary:
    enabled: false

fluent-bit:
  revisionHistoryLimit: 2
  config:
    # extraFiles:
    #   upstream.conf: |
    #     [UPSTREAM]
    #         loki
    outputs: |
      [OUTPUT]
          name loki
          match *
          host monitoring-app-loki-gateway.monitoring.svc.cluster.local
          port 80
          uri /loki/api/v1/push
          tenant_id {{ .Values.global.tenantId }}
          HTTP_User {{ .Values.global.loki.basicAuthUsername }}
          HTTP_Passwd {{ .Values.global.loki.basicAuthPassword }}
          labels job=fluentbit
          auto_kubernetes_labels on

grafana:
  revisionHistoryLimit: 2
  ingress:
    enabled: true
    annotations:
      cert-manager.io/cluster-issuer: code-monkey-root-ca-cluster-issuer
    hosts:
      - grafana.local
    tls:
      - secretName: grafana-tls-secret
        hosts:
          - grafana.local

  admin:
    existingSecret: grafana-admin-secret
    userKey: admin-user
    passwordKey: admin-password

  deploymentStrategy:
    type: Recreate

  persistence:
    enabled: true
    size: 100Mi
    storageClassName: local-path

  ## Configure grafana datasources
  ## ref: http://docs.grafana.org/administration/provisioning/#datasources
  # datasources:
  #   datasources.yaml: 
  #     apiVersion: 1
  #     datasources:
  #       - name: loki
  #         type: loki
  #         isDefault: true
  #         access: proxy
  #         url: http://monitoring-app-loki-gateway.monitoring.svc.cluster.local
  #         basicAuth: true
  #         basicAuthUser: "{{ .Values.global.loki.basicAuthUsername }}"
  #         basicAuthPassword: "{{ .Values.global.loki.basicAuthPassword }}"
  #         jsonData:
  #           maxLines: 1000
  #           httpHeaderName1: X-Scope-OrgID
  #         secureJsonData:
  #           httpHeaderValue1: "{{ .Values.global.tenantId }}"
